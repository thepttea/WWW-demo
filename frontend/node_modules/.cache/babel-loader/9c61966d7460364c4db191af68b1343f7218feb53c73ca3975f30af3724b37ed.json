{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.clearContainerCache = clearContainerCache;\nexports.injectCSS = injectCSS;\nexports.removeCSS = removeCSS;\nexports.updateCSS = updateCSS;\nvar _canUseDom = _interopRequireDefault(require(\"./canUseDom\"));\nvar _contains = _interopRequireDefault(require(\"./contains\"));\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nconst APPEND_ORDER = 'data-rc-order';\nconst APPEND_PRIORITY = 'data-rc-priority';\nconst MARK_KEY = `rc-util-key`;\nconst containerCache = new Map();\nfunction getMark({\n  mark\n} = {}) {\n  if (mark) {\n    return mark.startsWith('data-') ? mark : `data-${mark}`;\n  }\n  return MARK_KEY;\n}\nfunction getContainer(option) {\n  if (option.attachTo) {\n    return option.attachTo;\n  }\n  const head = document.querySelector('head');\n  return head || document.body;\n}\nfunction getOrder(prepend) {\n  if (prepend === 'queue') {\n    return 'prependQueue';\n  }\n  return prepend ? 'prepend' : 'append';\n}\n\n/**\n * Find style which inject by rc-util\n */\nfunction findStyles(container) {\n  return Array.from((containerCache.get(container) || container).children).filter(node => node.tagName === 'STYLE');\n}\nfunction injectCSS(css, option = {}) {\n  if (!(0, _canUseDom.default)()) {\n    return null;\n  }\n  const {\n    csp,\n    prepend,\n    priority = 0\n  } = option;\n  const mergedOrder = getOrder(prepend);\n  const isPrependQueue = mergedOrder === 'prependQueue';\n  const styleNode = document.createElement('style');\n  styleNode.setAttribute(APPEND_ORDER, mergedOrder);\n  if (isPrependQueue && priority) {\n    styleNode.setAttribute(APPEND_PRIORITY, `${priority}`);\n  }\n  if (csp?.nonce) {\n    styleNode.nonce = csp?.nonce;\n  }\n  styleNode.innerHTML = css;\n  const container = getContainer(option);\n  const {\n    firstChild\n  } = container;\n  if (prepend) {\n    // If is queue `prepend`, it will prepend first style and then append rest style\n    if (isPrependQueue) {\n      const existStyle = (option.styles || findStyles(container)).filter(node => {\n        // Ignore style which not injected by rc-util with prepend\n        if (!['prepend', 'prependQueue'].includes(node.getAttribute(APPEND_ORDER))) {\n          return false;\n        }\n\n        // Ignore style which priority less then new style\n        const nodePriority = Number(node.getAttribute(APPEND_PRIORITY) || 0);\n        return priority >= nodePriority;\n      });\n      if (existStyle.length) {\n        container.insertBefore(styleNode, existStyle[existStyle.length - 1].nextSibling);\n        return styleNode;\n      }\n    }\n\n    // Use `insertBefore` as `prepend`\n    container.insertBefore(styleNode, firstChild);\n  } else {\n    container.appendChild(styleNode);\n  }\n  return styleNode;\n}\nfunction findExistNode(key, option = {}) {\n  let {\n    styles\n  } = option;\n  styles ||= findStyles(getContainer(option));\n  return styles.find(node => node.getAttribute(getMark(option)) === key);\n}\nfunction removeCSS(key, option = {}) {\n  const existNode = findExistNode(key, option);\n  if (existNode) {\n    const container = getContainer(option);\n    container.removeChild(existNode);\n  }\n}\n\n/**\n * qiankun will inject `appendChild` to insert into other\n */\nfunction syncRealContainer(container, option) {\n  const cachedRealContainer = containerCache.get(container);\n\n  // Find real container when not cached or cached container removed\n  if (!cachedRealContainer || !(0, _contains.default)(document, cachedRealContainer)) {\n    const placeholderStyle = injectCSS('', option);\n    const {\n      parentNode\n    } = placeholderStyle;\n    containerCache.set(container, parentNode);\n    container.removeChild(placeholderStyle);\n  }\n}\n\n/**\n * manually clear container cache to avoid global cache in unit testes\n */\nfunction clearContainerCache() {\n  containerCache.clear();\n}\nfunction updateCSS(css, key, originOption = {}) {\n  const container = getContainer(originOption);\n  const styles = findStyles(container);\n  const option = {\n    ...originOption,\n    styles\n  };\n\n  // Sync real parent\n  syncRealContainer(container, option);\n  const existNode = findExistNode(key, option);\n  if (existNode) {\n    if (option.csp?.nonce && existNode.nonce !== option.csp?.nonce) {\n      existNode.nonce = option.csp?.nonce;\n    }\n    if (existNode.innerHTML !== css) {\n      existNode.innerHTML = css;\n    }\n    return existNode;\n  }\n  const newNode = injectCSS(css, option);\n  newNode.setAttribute(getMark(option), key);\n  return newNode;\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","clearContainerCache","injectCSS","removeCSS","updateCSS","_canUseDom","_interopRequireDefault","require","_contains","obj","__esModule","default","APPEND_ORDER","APPEND_PRIORITY","MARK_KEY","containerCache","Map","getMark","mark","startsWith","getContainer","option","attachTo","head","document","querySelector","body","getOrder","prepend","findStyles","container","Array","from","get","children","filter","node","tagName","css","csp","priority","mergedOrder","isPrependQueue","styleNode","createElement","setAttribute","nonce","innerHTML","firstChild","existStyle","styles","includes","getAttribute","nodePriority","Number","length","insertBefore","nextSibling","appendChild","findExistNode","key","find","existNode","removeChild","syncRealContainer","cachedRealContainer","placeholderStyle","parentNode","set","clear","originOption","newNode"],"sources":["/Users/bruce/WWW-Demo/frontend/node_modules/@rc-component/util/lib/Dom/dynamicCSS.js"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.clearContainerCache = clearContainerCache;\nexports.injectCSS = injectCSS;\nexports.removeCSS = removeCSS;\nexports.updateCSS = updateCSS;\nvar _canUseDom = _interopRequireDefault(require(\"./canUseDom\"));\nvar _contains = _interopRequireDefault(require(\"./contains\"));\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\nconst APPEND_ORDER = 'data-rc-order';\nconst APPEND_PRIORITY = 'data-rc-priority';\nconst MARK_KEY = `rc-util-key`;\nconst containerCache = new Map();\nfunction getMark({\n  mark\n} = {}) {\n  if (mark) {\n    return mark.startsWith('data-') ? mark : `data-${mark}`;\n  }\n  return MARK_KEY;\n}\nfunction getContainer(option) {\n  if (option.attachTo) {\n    return option.attachTo;\n  }\n  const head = document.querySelector('head');\n  return head || document.body;\n}\nfunction getOrder(prepend) {\n  if (prepend === 'queue') {\n    return 'prependQueue';\n  }\n  return prepend ? 'prepend' : 'append';\n}\n\n/**\n * Find style which inject by rc-util\n */\nfunction findStyles(container) {\n  return Array.from((containerCache.get(container) || container).children).filter(node => node.tagName === 'STYLE');\n}\nfunction injectCSS(css, option = {}) {\n  if (!(0, _canUseDom.default)()) {\n    return null;\n  }\n  const {\n    csp,\n    prepend,\n    priority = 0\n  } = option;\n  const mergedOrder = getOrder(prepend);\n  const isPrependQueue = mergedOrder === 'prependQueue';\n  const styleNode = document.createElement('style');\n  styleNode.setAttribute(APPEND_ORDER, mergedOrder);\n  if (isPrependQueue && priority) {\n    styleNode.setAttribute(APPEND_PRIORITY, `${priority}`);\n  }\n  if (csp?.nonce) {\n    styleNode.nonce = csp?.nonce;\n  }\n  styleNode.innerHTML = css;\n  const container = getContainer(option);\n  const {\n    firstChild\n  } = container;\n  if (prepend) {\n    // If is queue `prepend`, it will prepend first style and then append rest style\n    if (isPrependQueue) {\n      const existStyle = (option.styles || findStyles(container)).filter(node => {\n        // Ignore style which not injected by rc-util with prepend\n        if (!['prepend', 'prependQueue'].includes(node.getAttribute(APPEND_ORDER))) {\n          return false;\n        }\n\n        // Ignore style which priority less then new style\n        const nodePriority = Number(node.getAttribute(APPEND_PRIORITY) || 0);\n        return priority >= nodePriority;\n      });\n      if (existStyle.length) {\n        container.insertBefore(styleNode, existStyle[existStyle.length - 1].nextSibling);\n        return styleNode;\n      }\n    }\n\n    // Use `insertBefore` as `prepend`\n    container.insertBefore(styleNode, firstChild);\n  } else {\n    container.appendChild(styleNode);\n  }\n  return styleNode;\n}\nfunction findExistNode(key, option = {}) {\n  let {\n    styles\n  } = option;\n  styles ||= findStyles(getContainer(option));\n  return styles.find(node => node.getAttribute(getMark(option)) === key);\n}\nfunction removeCSS(key, option = {}) {\n  const existNode = findExistNode(key, option);\n  if (existNode) {\n    const container = getContainer(option);\n    container.removeChild(existNode);\n  }\n}\n\n/**\n * qiankun will inject `appendChild` to insert into other\n */\nfunction syncRealContainer(container, option) {\n  const cachedRealContainer = containerCache.get(container);\n\n  // Find real container when not cached or cached container removed\n  if (!cachedRealContainer || !(0, _contains.default)(document, cachedRealContainer)) {\n    const placeholderStyle = injectCSS('', option);\n    const {\n      parentNode\n    } = placeholderStyle;\n    containerCache.set(container, parentNode);\n    container.removeChild(placeholderStyle);\n  }\n}\n\n/**\n * manually clear container cache to avoid global cache in unit testes\n */\nfunction clearContainerCache() {\n  containerCache.clear();\n}\nfunction updateCSS(css, key, originOption = {}) {\n  const container = getContainer(originOption);\n  const styles = findStyles(container);\n  const option = {\n    ...originOption,\n    styles\n  };\n\n  // Sync real parent\n  syncRealContainer(container, option);\n  const existNode = findExistNode(key, option);\n  if (existNode) {\n    if (option.csp?.nonce && existNode.nonce !== option.csp?.nonce) {\n      existNode.nonce = option.csp?.nonce;\n    }\n    if (existNode.innerHTML !== css) {\n      existNode.innerHTML = css;\n    }\n    return existNode;\n  }\n  const newNode = injectCSS(css, option);\n  newNode.setAttribute(getMark(option), key);\n  return newNode;\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}